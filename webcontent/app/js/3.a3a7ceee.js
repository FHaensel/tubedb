(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"1cf4":function(e,t,s){"use strict";s("737e")},"5e02":function(e,t,s){"use strict";s.r(t);var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-layout",{attrs:{view:"hHh LpR fFf"}},[s("q-header",{staticClass:"bg-grey-7 text-grey-4",attrs:{reveal:"",elevated:""}},[s("q-toolbar",{staticClass:"fit row wrap justify-center items-start content-start title"},[s("div",{staticClass:"text-h5"},[e._v("TubeDB Diagram")])])],1),void 0!==e.model?s("q-drawer",{attrs:{"show-if-above":"",side:"left",behavior:"desktop","content-class":"bg-grey-4",width:e.drawerWidth}},[s("div",{staticClass:"fit row"},[s("q-scroll-area",{staticClass:"col-grow"},[s("q-list",[s("q-item",{attrs:{tag:"label"}},[s("q-item-section",[s("q-select",{attrs:{options:["none","hour","day","week","month","year"],label:"Aggregation by time","stack-label":"",borderless:"",dense:!0,"options-dense":!0},model:{value:e.timeAggregation,callback:function(t){e.timeAggregation=t},expression:"timeAggregation"}})],1)],1),s("q-item",{attrs:{tag:"label"}},[s("q-item-section",[s("q-select",{attrs:{options:["none","physical","step","empirical"],label:"Quality checks","stack-label":"",borderless:"",dense:!0,"options-dense":!0},model:{value:e.quality,callback:function(t){e.quality=t},expression:"quality"}})],1)],1),"none"!=e.timeAggregation?s("q-item",{staticStyle:{"user-select":"none"},attrs:{tag:"label"}},[s("q-item-section",{attrs:{avatar:""}},[s("q-checkbox",{attrs:{color:"teal",size:"xs"},model:{value:e.interpolation,callback:function(t){e.interpolation=t},expression:"interpolation"}})],1),s("q-item-section",[s("q-item-label",[e._v("Interpolation")])],1)],1):e._e(),s("q-separator"),s("q-item",[s("timeseries-selector",{on:{"plot-sensor-changed":function(t){e.selectedPlots=t.plots,e.selectedSensors=t.sensors}}})],1)],1)],1),s("div",{directives:[{name:"touch-pan",rawName:"v-touch-pan.prevent.mouse",value:e.onChangeDrawerWidth,expression:"onChangeDrawerWidth",modifiers:{prevent:!0,mouse:!0}}],staticClass:"drawerChanger"})],1)]):e._e(),s("q-page-container",{staticStyle:{position:"relative"}},[e.dataRequestSentCounter>e.dataRequestReceivedCounter?s("div",{staticStyle:{position:"absolute"}},[e._v("\n      Waiting for data ...\n    ")]):e._e(),void 0!==e.dataRequestError?s("div",{staticStyle:{position:"absolute"}},[e._v("\n      "+e._s(e.dataRequestError)+"\n    ")]):e._e(),s("div",{ref:"diagram"},[s("q-resize-observer",{attrs:{debounce:"250"},on:{resize:e.onChangeDiagramDimensions}})],1)])],1)},a=[],i=(s("ace4"),s("e6cf"),s("cfc3"),s("143c"),s("ddb0"),s("ded3")),r=s.n(i),n=s("2f62"),l=s("c71e"),d=(s("28d5"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-item-section",[void 0!==e.model?s("q-list",[s("q-item",{attrs:{tag:"label"}},[s("q-item-section",[s("q-select",{attrs:{options:e.projects,"option-label":"title",label:"Projects","stack-label":"",borderless:"",dense:"","options-dense":"","options-cover":"",multiple:""},model:{value:e.selectedProjects,callback:function(t){e.selectedProjects=t},expression:"selectedProjects"}})],1)],1),s("q-item",{attrs:{tag:"label"}},[s("q-item-section",[s("q-select",{attrs:{options:e.groups,"option-label":"title",label:"Groups","stack-label":"",borderless:"",dense:"","options-dense":"","options-cover":"",multiple:""},model:{value:e.selectedGroups,callback:function(t){e.selectedGroups=t},expression:"selectedGroups"}})],1)],1),s("q-item",{attrs:{tag:"label"}},[s("q-item-section",[s("q-select",{attrs:{options:e.plots,"option-label":"id",label:"Plots","stack-label":"",borderless:"",dense:"","options-dense":"","options-cover":"",multiple:""},model:{value:e.selectedPlots,callback:function(t){e.selectedPlots=t},expression:"selectedPlots"}})],1)],1),s("q-item",{attrs:{tag:"label"}},[s("q-item-section",[s("q-select",{attrs:{options:e.sensors,"option-label":"id",label:"Sensors","stack-label":"",borderless:"",dense:"","options-dense":"","options-cover":"",multiple:""},model:{value:e.selectedSensors,callback:function(t){e.selectedSensors=t},expression:"selectedSensors"}})],1)],1)],1):e._e()],1)}),c=[],u=(s("4e82"),{name:"timeseries-selector",props:[],data(){return{selectedProjects:[],selectedGroups:[],selectedPlots:[],selectedSensors:[]}},computed:r()(r()(r()({},Object(n["c"])({model:e=>e.model.data,modelLoading:e=>e.model.loading,modelError:e=>e.model.error})),Object(n["b"])({api:"api",apiGET:"apiGET",apiPOST:"apiPOST"})),{},{projects(){if(void 0===this.model)return[];let e=Object.values(this.model.projects);return e.sort(((e,t)=>{var s=e.title.toLowerCase(),o=t.title.toLowerCase();return s<o?-1:s>o?1:0})),e},groups(){if(void 0===this.model||0===this.selectedProjects.length)return[];var e=[];for(let t of this.selectedProjects){let s=t.groups.map((e=>this.model.groups[e]));e=e.concat(s)}return e.sort(((e,t)=>{var s=e.title.toLowerCase(),o=t.title.toLowerCase();return s<o?-1:s>o?1:0})),e},plots(){if(void 0===this.model||0===this.selectedGroups.length)return[];var e=new Set;for(let s of this.selectedGroups)for(let t of s.plots)e.add(t);let t=[...e].map((e=>this.model.plots[e]));return t.sort(((e,t)=>{var s=e.id.toLowerCase(),o=t.id.toLowerCase();return s<o?-1:s>o?1:0})),t},sensors(){if(void 0===this.model||0===this.selectedPlots.length)return[];var e=new Set;for(let s of this.selectedPlots)for(let t of s.sensors)e.add(t);let t=[...e].map((e=>this.model.sensors[e]));return t.sort(((e,t)=>{var s=e.id.toLowerCase(),o=t.id.toLowerCase();return s<o?-1:s>o?1:0})),t}}),methods:{onPlotSensorChanged(){this.$emit("plot-sensor-changed",{plots:this.selectedPlots,sensors:this.selectedSensors})}},watch:{selectedPlots(){this.onPlotSensorChanged()},selectedSensors(){this.onPlotSensorChanged()}},async mounted(){this.$store.dispatch("model/init")}}),p=u,h=s("2877"),m=s("4074"),g=s("1c1c"),v=s("66e5"),f=s("ddd8"),b=s("eebe"),q=s.n(b),w=Object(h["a"])(p,d,c,!1,null,"8c53e758",null),S=w.exports;function C(e){for(var t=[],s=0;s<e.length;s++){var o=e[s];t[s]=Number.isFinite(o)?o:null}return t}function y(e){let t,s,o,a,i,r,n=e.factor||.75;function l(e,t,s,o,a,i){return e>o?(t=a,s=i):t<a?(t=a,s=a+e):s>i&&(s=i,t=i-e),[t,s]}return{hooks:{ready:e=>{t=e.scales.x.min,s=e.scales.x.max,o=e.scales.y.min,a=e.scales.y.max,i=s-t,r=a-o;let d=e.root.querySelector(".u-over"),c=d.getBoundingClientRect();d.addEventListener("mousedown",(t=>{if(1===t.button){t.preventDefault();let a=t.clientX,i=e.scales.x.min,r=e.scales.x.max,n=e.posToVal(1,"x")-e.posToVal(0,"x");function s(t){t.preventDefault();let s=t.clientX,o=n*(s-a);e.setScale("x",{min:i-o,max:r-o})}function o(e){document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",o)}document.addEventListener("mousemove",s),document.addEventListener("mouseup",o)}})),d.addEventListener("wheel",(d=>{d.preventDefault();let{left:u,top:p}=e.cursor,h=u/c.width,m=1-p/c.height,g=e.posToVal(u,"x"),v=e.posToVal(p,"y"),f=e.scales.x.max-e.scales.x.min,b=e.scales.y.max-e.scales.y.min,q=d.deltaY<0?f*n:f/n,w=g-h*q,S=w+q;[w,S]=l(q,w,S,i,t,s);let C=d.deltaY<0?b*n:b/n,y=v-m*C,x=y+C;[y,x]=l(C,y,x,r,o,a),e.batch((()=>{e.setScale("x",{min:w,max:S})}))}))}}}}q()(w,"components",{QItemSection:m["a"],QList:g["a"],QItem:v["a"],QSelect:f["a"]});var x={components:{timeseriesSelector:S},data(){return{drawerWidth:400,data:void 0,uplot:void 0,dataRequestSentCounter:0,dataRequestReceivedCounter:0,dataRequestError:"init",timeAggregation:"hour",quality:"step",interpolation:!1,selectedPlots:[],selectedSensors:[]}},computed:r()(r()(r()({},Object(n["c"])({model:e=>e.model.data,modelLoading:e=>e.model.loading,modelError:e=>e.model.error})),Object(n["b"])({api:"api",apiGET:"apiGET",apiPOST:"apiPOST"})),{},{plotSensorList(){let e=[];for(let t of this.selectedSensors)for(let s of this.selectedPlots)if(s.sensorSet.has(t.id)){let o={plot:s.id,sensor:t.id};if(e.push(o),e.length>4)return e}return e}}),methods:{onChangeDrawerWidth(e){var t=e.delta.x;this.drawerWidth+=t,this.drawerWidth<30&&(this.drawerWidth=30),this.drawerWidth>800&&(this.drawerWidth=800)},onChangeDiagramDimensions(){if(void 0!==this.uplot&&void 0!==this.$refs.diagram){var e=this.$refs.diagram.clientWidth,t=400;this.uplot.setSize({width:e,height:t})}},createDiagram(){if(void 0!==this.uplot&&(this.uplot.destroy(),this.uplot=void 0),void 0===this.data)return;var e=this.$refs.diagram.clientWidth,t=400;console.log(e+" x "+t);let s={width:e,height:t,plugins:[y({factor:.75})],series:[{},{show:!0,spanGaps:!1,label:"Value",value:(e,t)=>null===t?"---":t.toFixed(2),stroke:"red",width:1}]};this.$refs.diagram.innderHTML="",this.uplot=new l["a"](s,this.data,this.$refs.diagram)},settingsChanged(){this.requestData()},async requestData(){if(void 0!==this.model){if(this.plotSensorList.length<1)return void(this.data=void 0);try{this.dataRequestSentCounter++;var e=this.dataRequestSentCounter;this.dataRequestError=void 0,console.time("apiPOST");var t={responseType:"arraybuffer"},s={settings:{timeAggregation:this.timeAggregation,quality:this.quality,interpolation:this.interpolation},timeseries:this.plotSensorList},o=await this.apiPOST(["tsdb","query_js"],s,t);if(e<this.dataRequestSentCounter)return;this.dataRequestReceivedCounter=e,console.log(o),console.timeEnd("apiPOST"),console.time("prepare");var a=o.data,i=new DataView(a),r=i.getInt32(0,!0),n=i.getInt32(4,!0);console.log(r),console.log(n);var l=[],d=new Int32Array(a,8,r);console.log(d),l[0]=d.map((e=>60*(e-36819360-60)));for(var c=0;c<n;c++){var u=new Float32Array(a,8+4*r*(c+1),r);l[c+1]=C(u)}console.timeEnd("prepare"),this.data=l}catch(p){if(console.log(p),e<this.dataRequestSentCounter)return;this.dataRequestError="ERROR receiving data",this.dataRequestReceivedCounter=e}}}},watch:{async model(){this.requestData()},data(){this.createDiagram()},timeAggregation(){this.settingsChanged()},quality(){this.settingsChanged()},interpolation(){this.settingsChanged()},plotSensorList(){this.settingsChanged()}},async mounted(){this.requestData(),this.$store.dispatch("model/init")}},P=x,L=(s("1cf4"),s("4d5a")),R=s("e359"),k=s("65c6"),E=s("9404"),D=s("4983"),T=s("8f8e"),j=s("0170"),Q=s("eb85"),O=s("09e3"),_=s("3980"),W=s("75c3"),A=Object(h["a"])(P,o,a,!1,null,"d72eb462",null);t["default"]=A.exports;q()(A,"components",{QLayout:L["a"],QHeader:R["a"],QToolbar:k["a"],QDrawer:E["a"],QScrollArea:D["a"],QList:g["a"],QItem:v["a"],QItemSection:m["a"],QSelect:f["a"],QCheckbox:T["a"],QItemLabel:j["a"],QSeparator:Q["a"],QPageContainer:O["a"],QResizeObserver:_["a"]}),q()(A,"directives",{TouchPan:W["a"]})},"737e":function(e,t,s){}}]);