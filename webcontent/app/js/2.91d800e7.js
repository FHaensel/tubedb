(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"0d72":function(e,t,s){},2915:function(e,t,s){"use strict";s("6462")},3443:function(e,t,s){"use strict";s("0d72")},"3a1b":function(e,t,s){"use strict";var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-toolbar",{staticClass:"title fit row wrap justify-between"},[s("pages-menu",{attrs:{active:e.active}}),s("div",{staticClass:"text-h5"},[e._v(e._s(e.title))]),s("div")],1)},i=[],n=(s("e6cf"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-btn",{attrs:{color:"primary",round:"",icon:"menu"}},[s("q-menu",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[s("q-list",{staticStyle:{"min-width":"100px"}},e._l(e.items,(function(t){return s("q-item",{key:t.title,class:{activeitem:e.active===t.link},attrs:{to:t.link,clickable:""}},[s("q-item-section",[e._v("\r\n          "+e._s(t.title)+"\r\n        ")])],1)})),1)],1)],1)}),l=[],a={name:"pages-menu",props:["active"],data(){return{items:[{title:"Overview",link:"/overview"},{title:"Metadata",link:"/model"},{title:"Diagrams",link:"/diagram"}]}},computed:{},methods:{},watch:{},async mounted(){}},r=a,d=(s("2915"),s("2877")),c=s("9c40"),u=s("4e73"),m=s("1c1c"),p=s("66e5"),h=s("4074"),v=s("eebe"),g=s.n(v),f=Object(d["a"])(r,n,l,!1,null,"2f774f3d",null),b=f.exports;g()(f,"components",{QBtn:c["a"],QMenu:u["a"],QList:m["a"],QItem:p["a"],QItemSection:h["a"]});var q={name:"pages-toolbar",props:["title","active"],components:{pagesMenu:b},data(){return{}},computed:{},methods:{},watch:{},async mounted(){}},y=q,x=(s("611f"),s("65c6")),S=Object(d["a"])(y,o,i,!1,null,"9fde52e0",null);t["a"]=S.exports;g()(S,"components",{QToolbar:x["a"]})},"4dda":function(e,t,s){},"5e02":function(e,t,s){"use strict";s.r(t);var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-layout",{attrs:{view:"hHh LpR fFf"}},[s("q-header",{staticClass:"bg-grey-7 text-grey-4",attrs:{reveal:"",elevated:""}},[s("pages-toolbar",{attrs:{title:"TubeDB Diagram",active:"/diagram"}})],1),void 0!==e.model?s("q-drawer",{attrs:{"show-if-above":"",side:"left",behavior:"desktop","content-class":"bg-grey-4",width:e.drawerWidth}},[s("div",{staticClass:"fit row"},[s("q-scroll-area",{staticClass:"col-grow"},[s("q-list",[s("q-item",{attrs:{tag:"label"}},[s("q-item-section",[s("q-select",{attrs:{options:["none","hour","day","week","month","year"],label:"Aggregation by time","stack-label":"",borderless:"",dense:!0,"options-dense":!0},model:{value:e.timeAggregation,callback:function(t){e.timeAggregation=t},expression:"timeAggregation"}})],1)],1),s("q-item",{attrs:{tag:"label"}},[s("q-item-section",[s("q-select",{attrs:{options:["none","physical","step","empirical"],label:"Quality checks","stack-label":"",borderless:"",dense:!0,"options-dense":!0},model:{value:e.quality,callback:function(t){e.quality=t},expression:"quality"}})],1)],1),"none"!=e.timeAggregation?s("q-item",{staticStyle:{"user-select":"none"},attrs:{tag:"label"}},[s("q-item-section",{attrs:{avatar:""}},[s("q-checkbox",{attrs:{color:"teal",size:"xs"},model:{value:e.interpolation,callback:function(t){e.interpolation=t},expression:"interpolation"}})],1),s("q-item-section",[s("q-item-label",[e._v("Interpolation")])],1)],1):e._e(),s("q-separator"),s("q-item",[s("timeseries-selector",{attrs:{multiTimeseries:e.multiTimeseries},on:{"plot-sensor-changed":function(t){e.selectedPlots=t.plots,e.selectedSensors=t.sensors}}})],1),s("q-separator"),e.plotSensorList.length>0?[e._v("\n          Selected timeseries:\n        "),e._l(e.plotSensorList,(function(t){return s("q-item",{key:t.plot+"/"+t.sensor},[e._v("\n          "+e._s(t.plot)+" / "+e._s(t.sensor)+"\n        ")])}))]:e._e()],2)],1),s("div",{directives:[{name:"touch-pan",rawName:"v-touch-pan.prevent.mouse",value:e.onChangeDrawerWidth,expression:"onChangeDrawerWidth",modifiers:{prevent:!0,mouse:!0}}],staticClass:"drawerChanger"})],1)]):e._e(),s("q-page-container",[s("div",{staticStyle:{position:"relative"}},[e.dataRequestSentCounter>e.dataRequestReceivedCounter?s("div",{staticStyle:{position:"absolute",top:"50px",left:"50px"}},[e._v("\n      Waiting for data ...\n    ")]):e._e(),void 0!==e.dataRequestError?s("div",{staticStyle:{position:"absolute",top:"100px",left:"100px"}},[e._v("\n      "+e._s(e.dataRequestError)+"\n    ")]):e._e(),s("div",{staticStyle:{"margin-top":"10px","margin-left":"10px"}},[s("b",[e._v("Inspect timeseries values")]),e._v(": Move mouse over diagram to show time / measurement values.\n      "),s("br"),s("b",[e._v("Zoom in/out")]),e._v(": Place mouse on diagram and rotate the mouse wheel.\n    ")]),s("timeseries-diagram",{attrs:{data:e.data}})],1)])],1)},i=[],n=(s("ace4"),s("e6cf"),s("cfc3"),s("143c"),s("ddb0"),s("ded3")),l=s.n(n),a=s("2f62"),r=s("3a1b"),d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-item-section",[void 0!==e.model?s("q-list",[s("q-item",{attrs:{tag:"label"}},[s("q-item-section",[s("q-select",{attrs:{options:e.projects,"option-value":"id",for:"id","option-label":"title",label:"Projects","stack-label":"",borderless:"",dense:"","options-dense":"","options-cover":"",multiple:e.multiTimeseries},scopedSlots:e._u([e.selectedProjects.length>0?{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"cancel"},on:{click:function(t){t.stopPropagation(),e.selectedProjectsModel=null}}})]},proxy:!0}:null],null,!0),model:{value:e.selectedProjectsModel,callback:function(t){e.selectedProjectsModel=t},expression:"selectedProjectsModel"}})],1)],1),e.selectedProjects.length>0?[s("q-item",{attrs:{tag:"label"}},[s("q-item-section",[s("q-select",{attrs:{options:e.groups,"option-value":"id",for:"id","option-label":"title",label:"Groups","stack-label":"",borderless:"",dense:"","options-dense":"","options-cover":"",multiple:e.multiTimeseries},scopedSlots:e._u([e.selectedGroups.length>0?{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"cancel"},on:{click:function(t){t.stopPropagation(),e.selectedGroupsModel=null}}})]},proxy:!0}:null],null,!0),model:{value:e.selectedGroupsModel,callback:function(t){e.selectedGroupsModel=t},expression:"selectedGroupsModel"}})],1)],1),e.selectedGroups.length>0?[s("q-item",{attrs:{tag:"label"}},[s("q-item-section",[s("q-select",{attrs:{options:e.plots,"option-value":"id",for:"id","option-label":"id",label:"Plots","stack-label":"",borderless:"",dense:"","options-dense":"","options-cover":"",multiple:e.multiTimeseries},scopedSlots:e._u([e.selectedPlots.length>0?{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"cancel"},on:{click:function(t){t.stopPropagation(),e.selectedPlotsModel=null}}})]},proxy:!0}:null],null,!0),model:{value:e.selectedPlotsModel,callback:function(t){e.selectedPlotsModel=t},expression:"selectedPlotsModel"}}),1===e.plotstations.length&&1===e.selectedPlots.length&&e.plotstations[0].id!==e.selectedPlots[0].id?s("q-item-label",{attrs:{caption:""}},[e._v("\r\n              "+e._s(e.plotstations[0].id)+"\r\n            ")]):e._e()],1)],1),e.selectedPlots.length>0?[e.plotstations.length>1?s("q-item",{attrs:{tag:"label"}},[s("q-item-section",[s("q-select",{attrs:{options:e.plotstations,"option-value":"id",for:"id","option-label":"id",label:"Plot-Stations","stack-label":"",borderless:"",dense:"","options-dense":"","options-cover":"",multiple:e.multiTimeseries},scopedSlots:e._u([e.selectedPlotstations.length>0?{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"cancel"},on:{click:function(t){t.stopPropagation(),e.selectedPlotstationsModel=null}}})]},proxy:!0}:null],null,!0),model:{value:e.selectedPlotstationsModel,callback:function(t){e.selectedPlotstationsModel=t},expression:"selectedPlotstationsModel"}})],1)],1):e._e(),e.selectedPlotstations.length>0?[s("q-item",{attrs:{tag:"label"}},[s("q-item-section",[s("q-select",{attrs:{options:e.sensors,"option-value":"id",for:"id","option-label":"id",label:"Sensors","stack-label":"",borderless:"",dense:"","options-dense":"","options-cover":"",multiple:e.multiTimeseries},scopedSlots:e._u([e.selectedSensors.length>0?{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"cancel"},on:{click:function(t){t.stopPropagation(),e.selectedSensorsModel=null}}})]},proxy:!0}:null],null,!0),model:{value:e.selectedSensorsModel,callback:function(t){e.selectedSensorsModel=t},expression:"selectedSensorsModel"}})],1)],1),e.selectedSensors.length>0?void 0:s("div",[e._v("\r\n              no sensor selected\r\n            ")])]:s("div",[e._v("\r\n            no plot-station selected\r\n          ")])]:s("div",[e._v("\r\n          no plot selected\r\n        ")])]:s("div",[e._v("\r\n        no group selected\r\n      ")])]:s("div",[e._v("\r\n      no project selected\r\n    ")])],2):e._e()],1)},c=[],u=(s("4e82"),{name:"timeseries-selector",props:["multiTimeseries"],data(){return{selectedProjectsModel:null,selectedGroupsModel:null,selectedPlotsModel:null,selectedPlotstationsModel:null,selectedSensorsModel:null}},computed:l()(l()(l()({},Object(a["c"])({model:e=>e.model.data,modelLoading:e=>e.model.loading,modelError:e=>e.model.error})),Object(a["b"])({api:"api",apiGET:"apiGET",apiPOST:"apiPOST"})),{},{selectedProjects(){return null===this.selectedProjectsModel?[]:this.multiTimeseries?this.selectedProjectsModel:[this.selectedProjectsModel]},selectedGroups(){return null===this.selectedGroupsModel?[]:this.multiTimeseries?this.selectedGroupsModel:[this.selectedGroupsModel]},selectedPlots(){return null===this.selectedPlotsModel?[]:this.multiTimeseries?this.selectedPlotsModel:[this.selectedPlotsModel]},selectedPlotstations(){return null===this.selectedPlotstationsModel?0===this.plotstations.length?[]:[this.plotstations[0]]:this.multiTimeseries?this.selectedPlotstationsModel:[this.selectedPlotstationsModel]},selectedSensors(){return null===this.selectedSensorsModel?[]:this.multiTimeseries?this.selectedSensorsModel:[this.selectedSensorsModel]},projects(){if(void 0===this.model)return[];let e=Object.values(this.model.projects);return e.sort(((e,t)=>{var s=e.title.toLowerCase(),o=t.title.toLowerCase();return s<o?-1:s>o?1:0})),e},groups(){if(void 0===this.model||0===this.selectedProjects.length)return[];var e=[];for(let t of this.selectedProjects){let s=t.groups.map((e=>this.model.groups[e]));e=e.concat(s)}return e.sort(((e,t)=>{var s=e.title.toLowerCase(),o=t.title.toLowerCase();return s<o?-1:s>o?1:0})),e},plots(){if(void 0===this.model||0===this.selectedGroups.length)return[];var e=new Set;for(let s of this.selectedGroups)for(let t of s.plots)e.add(t);let t=[...e].map((e=>this.model.plots[e]));return t.sort(((e,t)=>{var s=e.id.toLowerCase(),o=t.id.toLowerCase();return s<o?-1:s>o?1:0})),t},plotstations(){var e=[];for(let t of this.selectedPlots)switch(t.stations.length){case 0:{let s=t.id,o=t.sensorSet;e.push({id:s,sensorSet:o});break}case 1:{let s=t.stations[0],o=t.id+":"+s,i=this.model.stations[s].sensorSet;e.push({id:o,sensorSet:i});break}default:{let s=t.id;e.push({id:s});for(let o of t.stations){let s=t.id+":"+o,i=this.model.stations[o].sensorSet;e.push({id:s,sensorSet:i})}}}return e},sensors(){if(void 0===this.model||0===this.selectedPlots.length)return[];var e=new Set;for(let s of this.selectedPlots)for(let t of s.sensors)e.add(t);let t=[...e].map((e=>this.model.sensors[e]));return t.sort(((e,t)=>{var s=e.id.toLowerCase(),o=t.id.toLowerCase();return s<o?-1:s>o?1:0})),t}}),methods:{onPlotSensorChanged(){this.$emit("plot-sensor-changed",{plots:this.selectedPlotstations,sensors:this.selectedSensors})}},watch:{selectedPlotStations(){this.onPlotSensorChanged()},selectedSensors(){this.onPlotSensorChanged()}},async mounted(){this.$store.dispatch("model/init")}}),m=u,p=s("2877"),h=s("4074"),v=s("1c1c"),g=s("66e5"),f=s("ddd8"),b=s("0016"),q=s("0170"),y=s("eebe"),x=s.n(y),S=Object(p["a"])(m,d,c,!1,null,"5bfee193",null),w=S.exports;x()(S,"components",{QItemSection:h["a"],QList:v["a"],QItem:g["a"],QSelect:f["a"],QIcon:b["a"],QItemLabel:q["a"]});var P=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"diagram"},[s("q-resize-observer",{attrs:{debounce:"250"},on:{resize:e.onChangeDiagramDimensions}})],1)},M=[],_=s("c71e");s("28d5");function C(e){function t(e,t,s){let o,i,n,l,a,r=e.root.querySelector(".u-over"),d={x:0,y:0,dx:0,dy:0},c={x:0,y:0,dx:0,dy:0};function u(e,t){let s=t.touches,i=s[0],n=i.clientX-o.left,l=i.clientY-o.top;if(1===s.length)e.x=n,e.y=l,e.d=e.dx=e.dy=1;else{let s=t.touches[1],i=s.clientX-o.left,a=s.clientY-o.top,r=Math.min(n,i),d=Math.min(l,a),c=Math.max(n,i),u=Math.max(l,a);e.y=(d+u)/2,e.x=(r+c)/2,e.dx=c-r,e.dy=u-d,e.d=Math.sqrt(e.dx*e.dx+e.dy*e.dy)}}let m=!1;function p(){m=!1;let t=c.x,s=c.y,r=d.d/c.d,u=d.d/c.d,p=t/o.width,h=1-s/o.height,v=i*r,g=l-p*v,f=g+v,b=n*u,q=a-h*b,y=q+b;e.batch((()=>{e.setScale("x",{min:g,max:f}),e.setScale("y",{min:q,max:y})}))}function h(e){u(c,e),m||(m=!0,requestAnimationFrame(p))}r.addEventListener("touchstart",(function(t){o=r.getBoundingClientRect(),u(d,t),i=e.scales.x.max-e.scales.x.min,n=e.scales.y.max-e.scales.y.min;let s=d.x,c=d.y;l=e.posToVal(s,"x"),a=e.posToVal(c,"y"),document.addEventListener("touchmove",h,{passive:!0})})),r.addEventListener("touchend",(function(e){document.removeEventListener("touchmove",h,{passive:!0})})),r.addEventListener("mousedown",(function(t){console.log("mousedown"),o=r.getBoundingClientRect(),u(d,t),i=e.scales.x.max-e.scales.x.min,n=e.scales.y.max-e.scales.y.min;let s=d.x,c=d.y;l=e.posToVal(s,"x"),a=e.posToVal(c,"y"),document.addEventListener("mousemove",h,{passive:!0})})),r.addEventListener("mouseup",(function(e){console.log("mouseup"),document.removeEventListener("mousemove",h,{passive:!0})}))}return{hooks:{init:t}}}function k(e){let t,s,o,i,n,l,a=e.factor||.75;function r(e,t,s,o,i,n){return e>o?(t=i,s=n):t<i?(t=i,s=i+e):s>n&&(s=n,t=n-e),[t,s]}return{hooks:{ready:e=>{t=e.scales.x.min,s=e.scales.x.max,o=e.scales.y.min,i=e.scales.y.max,n=s-t,l=i-o;let d=e.root.querySelector(".u-over"),c=d.getBoundingClientRect();d.addEventListener("mousedown",(t=>{if(1===t.button){t.preventDefault();let i=t.clientX,n=e.scales.x.min,l=e.scales.x.max,a=e.posToVal(1,"x")-e.posToVal(0,"x");function s(t){t.preventDefault();let s=t.clientX,o=a*(s-i);e.setScale("x",{min:n-o,max:l-o})}function o(e){document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",o)}document.addEventListener("mousemove",s),document.addEventListener("mouseup",o)}})),d.addEventListener("wheel",(d=>{d.preventDefault();let{left:u,top:m}=e.cursor,p=u/c.width,h=1-m/c.height,v=e.posToVal(u,"x"),g=e.posToVal(m,"y"),f=e.scales.x.max-e.scales.x.min,b=e.scales.y.max-e.scales.y.min,q=d.deltaY<0?f*a:f/a,y=v-p*q,x=y+q;[y,x]=r(q,y,x,n,t,s);let S=d.deltaY<0?b*a:b/a,w=g-h*S,P=w+S;[w,P]=r(S,w,P,l,o,i),e.batch((()=>{e.setScale("x",{min:y,max:x})}))}))}}}}var L={name:"timeseries-diagram",props:["data"],components:{},data(){return{uplot:void 0}},computed:l()(l()({},Object(a["c"])({})),Object(a["b"])({})),methods:{onChangeDiagramDimensions(){if(void 0!==this.uplot&&void 0!==this.$refs.diagram){var e=this.$refs.diagram.clientWidth,t=400;this.uplot.setSize({width:e,height:t})}},createDiagram(){if(void 0!==this.uplot&&(this.uplot.destroy(),this.uplot=void 0),void 0===this.data)return;var e=this.$refs.diagram.clientWidth,t=400;let s={width:e,height:t,cursor:{x:!1,y:!1,drag:{x:!1,y:!1}},plugins:[C({}),k({factor:.75})],series:[{},{show:!0,spanGaps:!1,label:"Value",value:(e,t)=>null===t?"---":t.toFixed(2),stroke:"red",width:1}]};this.$refs.diagram.innderHTML="",this.uplot=new _["a"](s,this.data,this.$refs.diagram)}},watch:{data(){this.createDiagram()}},async mounted(){}},T=L,j=s("3980"),E=Object(p["a"])(T,P,M,!1,null,"a773ad00",null),R=E.exports;function Q(e){for(var t=[],s=0;s<e.length;s++){var o=e[s];t[s]=Number.isFinite(o)?o:null}return t}function D(e){for(var t=[],s=0;s<e.length;s++){var o=e[s];t[s]=60*(o-36819360-60)}return t}x()(E,"components",{QResizeObserver:j["a"]});var O={name:"DiagramLayout",components:{pagesToolbar:r["a"],timeseriesSelector:w,timeseriesDiagram:R},data(){return{drawerWidth:400,data:void 0,dataRequestSentCounter:0,dataRequestReceivedCounter:0,dataRequestError:"no data loaded",timeAggregation:"hour",quality:"step",interpolation:!1,selectedPlots:[],selectedSensors:[],multiTimeseries:!1}},computed:l()(l()(l()({},Object(a["c"])({model:e=>e.model.data,modelLoading:e=>e.model.loading,modelError:e=>e.model.error})),Object(a["b"])({api:"api",apiGET:"apiGET",apiPOST:"apiPOST"})),{},{plotSensorList(){let e=[];for(let t of this.selectedSensors)for(let s of this.selectedPlots)if(s.sensorSet.has(t.id)){let o={plot:s.id,sensor:t.id};if(e.push(o),e.length>4)return e}return e}}),methods:{onChangeDrawerWidth(e){var t=e.delta.x;this.drawerWidth+=t,this.drawerWidth<30&&(this.drawerWidth=30),this.drawerWidth>800&&(this.drawerWidth=800)},settingsChanged(){this.requestData()},async requestData(){if(void 0!==this.model){if(this.plotSensorList.length<1)return void(this.data=void 0);try{this.dataRequestSentCounter++;var e=this.dataRequestSentCounter;this.dataRequestError=void 0;var t={responseType:"arraybuffer"},s={settings:{timeAggregation:this.timeAggregation,quality:this.quality,interpolation:this.interpolation},timeseries:this.plotSensorList},o=await this.apiPOST(["tsdb","query_js"],s,t);if(e<this.dataRequestSentCounter)return;this.dataRequestReceivedCounter=e;var i=o.data,n=new DataView(i),l=n.getInt32(0,!0),a=n.getInt32(4,!0),r=[],d=new Int32Array(i,8,l);r[0]=D(d);for(var c=0;c<a;c++){var u=new Float32Array(i,8+4*l*(c+1),l);r[c+1]=Q(u)}this.data=r}catch(m){if(console.log(m),e<this.dataRequestSentCounter)return;this.dataRequestError="ERROR receiving data",this.dataRequestReceivedCounter=e}}}},watch:{async model(){this.requestData()},timeAggregation(){this.settingsChanged()},quality(){this.settingsChanged()},interpolation(){this.settingsChanged()},plotSensorList(){this.settingsChanged()}},async mounted(){this.requestData(),this.$store.dispatch("model/init")}},G=O,I=(s("3443"),s("4d5a")),A=s("e359"),W=s("9404"),$=s("4983"),V=s("8f8e"),z=s("eb85"),B=s("09e3"),F=s("75c3"),X=Object(p["a"])(G,o,i,!1,null,"3973a453",null);t["default"]=X.exports;x()(X,"components",{QLayout:I["a"],QHeader:A["a"],QDrawer:W["a"],QScrollArea:$["a"],QList:v["a"],QItem:g["a"],QItemSection:h["a"],QSelect:f["a"],QCheckbox:V["a"],QItemLabel:q["a"],QSeparator:z["a"],QPageContainer:B["a"]}),x()(X,"directives",{TouchPan:F["a"]})},"611f":function(e,t,s){"use strict";s("4dda")},6462:function(e,t,s){}}]);